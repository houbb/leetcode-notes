---

title: å•è°ƒæ ˆï¼ˆMonotonic Stackï¼‰
date: 2025-10-06
categories: [Althgorim]
tags: [althgorim, monotonic-stack]
published: true
---

## ğŸ§© ä¸€ã€å•è°ƒæ ˆæ˜¯ä»€ä¹ˆï¼Ÿ

**å•è°ƒæ ˆ** æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ˆç»“æ„ï¼Œå®ƒåœ¨â€œæ ˆä¸­å…ƒç´ å•è°ƒé€’å¢æˆ–å•è°ƒé€’å‡â€è¿™ä¸€è§„åˆ™ä¸‹è¿›è¡Œæ“ä½œã€‚

å®ƒä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ä¸€ç§ **ä½¿ç”¨æ ˆè§£å†³æŸç±»é—®é¢˜çš„æŠ€å·§**ã€‚

ç®€å•æ¥è¯´ï¼š

* **å•è°ƒé€’å¢æ ˆ**ï¼šæ ˆå†…å…ƒç´ ä»æ ˆåº•åˆ°æ ˆé¡¶æ˜¯é€’å¢çš„ï¼ˆè¶Šå¾€ä¸Šè¶Šå¤§ï¼‰ã€‚
* **å•è°ƒé€’å‡æ ˆ**ï¼šæ ˆå†…å…ƒç´ ä»æ ˆåº•åˆ°æ ˆé¡¶æ˜¯é€’å‡çš„ï¼ˆè¶Šå¾€ä¸Šè¶Šå°ï¼‰ã€‚

---

## ğŸ§  äºŒã€ä¸ºä»€ä¹ˆéœ€è¦å•è°ƒæ ˆï¼Ÿ

åœ¨å¾ˆå¤šç®—æ³•é¢˜ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™ç§éœ€æ±‚ï¼š

> å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæ‰¾å‡ºå®ƒ **å·¦è¾¹/å³è¾¹** ç¬¬ä¸€ä¸ªæ¯”å®ƒ **å¤§/å°** çš„å…ƒç´ ã€‚

ä¾‹å¦‚ï¼š

```
è¾“å…¥: [2, 1, 4, 3]
è¾“å‡º:
  æ¯ä¸ªå…ƒç´ å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ ï¼š
  2 -> 4
  1 -> 4
  4 -> æ²¡æœ‰
  3 -> æ²¡æœ‰
```

å¦‚æœæš´åŠ›åšæ³•å°±æ˜¯åµŒå¥—å¾ªç¯ï¼šO(nÂ²)ã€‚

è€Œç”¨å•è°ƒæ ˆï¼Œè¿™ç§é—®é¢˜å¯ä»¥åœ¨ **O(n)** æ—¶é—´è§£å†³ã€‚

---

## ğŸ§© ä¸‰ã€å·¥ä½œåŸç†ï¼ˆæ ¸å¿ƒæ€æƒ³ï¼‰

æˆ‘ä»¬ä»¥ã€Œæ‰¾å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€ä¸ºä¾‹æ¥è¯´æ˜ï¼š

```java
int[] nextGreaterElements(int[] nums) {
    int n = nums.length;
    int[] res = new int[n];
    Arrays.fill(res, -1);
    Deque<Integer> stack = new ArrayDeque<>(); // å­˜æ”¾ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰

    for (int i = 0; i < n; i++) {
        // å½“å‰å…ƒç´ æ¯”æ ˆé¡¶å…ƒç´ å¤§ â†’ å½“å‰å…ƒç´ å°±æ˜¯æ ˆé¡¶å…ƒç´ çš„â€œä¸‹ä¸€ä¸ªæ›´å¤§å€¼â€
        while (!stack.isEmpty() && nums[i] > nums[stack.peek()]) {
            int idx = stack.pop();
            res[idx] = nums[i];
        }
        // å½“å‰ç´¢å¼•å…¥æ ˆ
        stack.push(i);
    }
    return res;
}
```

### ğŸ” æ ¸å¿ƒé€»è¾‘ï¼š

* æ ˆä¸­ä¿æŒçš„æ˜¯ä¸€ä¸ª **å•è°ƒé€’å‡æ ˆ**ï¼ˆæ ˆé¡¶æœ€å°ï¼‰ã€‚
* å½“é‡åˆ°æ¯”æ ˆé¡¶å¤§çš„å…ƒç´ ï¼Œå°±èƒ½â€œç»“ç®—â€æ ˆé¡¶ã€‚
* æ¯ä¸ªå…ƒç´ æœ€å¤šè¿›å‡ºæ ˆä¸€æ¬¡ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ O(n)ã€‚

---

## âš™ï¸ å››ã€å•è°ƒæ ˆçš„å¸¸è§ç±»å‹ä¸åº”ç”¨åœºæ™¯

| ç±»å‹             | æ ˆä¸­å•è°ƒæ€§    | ç›®æ ‡             | å¸¸è§é¢˜ç›®ç¤ºä¾‹       |
| -------------- | -------- | -------------- | ------------ |
| **å•è°ƒé€’å‡æ ˆ**      | ä»æ ˆåº•åˆ°æ ˆé¡¶é€’å‡ | æ‰¾â€œå³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å€¼â€    | ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€æ¯æ—¥æ¸©åº¦ |
| **å•è°ƒé€’å¢æ ˆ**      | ä»æ ˆåº•åˆ°æ ˆé¡¶é€’å¢ | æ‰¾â€œå³è¾¹ç¬¬ä¸€ä¸ªæ›´å°å€¼â€    | æŸ±çŠ¶å›¾æœ€å¤§çŸ©å½¢ã€æ¥é›¨æ°´  |
| **åå‘éå† + å•è°ƒæ ˆ** | ä»å³å¾€å·¦éå†   | æ‰¾â€œå·¦è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§/æ›´å°å€¼â€ | å¯¹ç§°ç±»é¢˜å‹        |

---

## ğŸ§® äº”ã€ç»å…¸é¢˜ç›®è®²è§£

### ğŸ§Š ä¾‹1ï¼šLeetCode 739 â€” æ¯æ—¥æ¸©åº¦

> ç»™å®šä¸€ç»„æ¸©åº¦ï¼Œè¿”å›æ¯ä¸€å¤©éœ€è¦ç­‰å‡ å¤©æ‰ä¼šé‡åˆ°æ›´é«˜çš„æ¸©åº¦ã€‚

```java
public int[] dailyTemperatures(int[] temperatures) {
    int n = temperatures.length;
    int[] res = new int[n];
    Deque<Integer> stack = new ArrayDeque<>(); // å­˜æ”¾ä¸‹æ ‡

    for (int i = 0; i < n; i++) {
        while (!stack.isEmpty() && temperatures[i] > temperatures[stack.peek()]) {
            int idx = stack.pop();
            res[idx] = i - idx;
        }
        stack.push(i);
    }
    return res;
}
```

**æ€è·¯**ï¼š

* æ ˆä¸­å­˜æ”¾è¿˜æ²¡æœ‰é‡åˆ°â€œæ›´é«˜æ¸©åº¦â€çš„å¤©æ•°ç´¢å¼•ã€‚
* æ¯é‡åˆ°æ›´é«˜æ¸©åº¦ï¼Œå°±æ›´æ–°ç»“æœã€‚

---

### ğŸ§± ä¾‹2ï¼šLeetCode 84 â€” æŸ±çŠ¶å›¾ä¸­æœ€å¤§çŸ©å½¢

> ç»™å®šæ¯ä¸ªæŸ±å­çš„é«˜åº¦ï¼Œæ‰¾èƒ½å½¢æˆçš„æœ€å¤§çŸ©å½¢é¢ç§¯ã€‚

```java
public int largestRectangleArea(int[] heights) {
    int n = heights.length;
    Deque<Integer> stack = new ArrayDeque<>();
    int max = 0;

    for (int i = 0; i <= n; i++) {
        int cur = (i == n ? 0 : heights[i]);
        while (!stack.isEmpty() && cur < heights[stack.peek()]) {
            int h = heights[stack.pop()];
            int left = stack.isEmpty() ? -1 : stack.peek();
            int width = i - left - 1;
            max = Math.max(max, h * width);
        }
        stack.push(i);
    }
    return max;
}
```

**æ€è·¯**ï¼š

* å•è°ƒé€’å¢æ ˆï¼Œç”¨äºç¡®å®šæ¯ä¸ªæŸ±å­â€œå·¦è¾¹ç¬¬ä¸€ä¸ªæ›´çŸ®çš„æŸ±å­â€å’Œâ€œå³è¾¹ç¬¬ä¸€ä¸ªæ›´çŸ®çš„æŸ±å­â€ã€‚
* å‡ºæ ˆæ—¶è®¡ç®—é¢ç§¯ã€‚

---

### ğŸŒ§ ä¾‹3ï¼šLeetCode 42 â€” æ¥é›¨æ°´

> åˆ©ç”¨å•è°ƒé€’å‡æ ˆæ±‚â€œå½“å‰é«˜åº¦èƒ½å½¢æˆçš„æ°´é‡â€ã€‚

```java
public int trap(int[] height) {
    int n = height.length, res = 0;
    Deque<Integer> stack = new ArrayDeque<>();

    for (int i = 0; i < n; i++) {
        while (!stack.isEmpty() && height[i] > height[stack.peek()]) {
            int mid = stack.pop();
            if (stack.isEmpty()) break;
            int left = stack.peek();
            int width = i - left - 1;
            int h = Math.min(height[left], height[i]) - height[mid];
            res += width * h;
        }
        stack.push(i);
    }
    return res;
}
```

---

## ğŸ§­ å…­ã€é€šç”¨æ¨¡æ¿æ€»ç»“

```java
for (int i = 0; i < n; i++) {
    while (!stack.isEmpty() && æ»¡è¶³å•è°ƒæ€§è¢«ç ´åçš„æ¡ä»¶) {
        // å‡ºæ ˆå¹¶å¤„ç†é€»è¾‘
    }
    stack.push(i);
}
```

**æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼š**

* æƒ³æ‰¾â€œå³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§â€ï¼šé€’å‡æ ˆ
* æƒ³æ‰¾â€œå³è¾¹ç¬¬ä¸€ä¸ªæ›´å°â€ï¼šé€’å¢æ ˆ
* æƒ³æ‰¾â€œå·¦è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§â€ï¼šåå‘éå† + é€’å‡æ ˆ
* æƒ³æ‰¾â€œå·¦è¾¹ç¬¬ä¸€ä¸ªæ›´å°â€ï¼šåå‘éå† + é€’å¢æ ˆ

---

## ğŸ¯ ä¸ƒã€æ€»ç»“

| åœºæ™¯      | æ ˆç±»å‹   | éå†æ–¹å‘ |
| ------- | ----- | ---- |
| å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§ | å•è°ƒé€’å‡æ ˆ | ä»å·¦åˆ°å³ |
| å³è¾¹ç¬¬ä¸€ä¸ªæ›´å° | å•è°ƒé€’å¢æ ˆ | ä»å·¦åˆ°å³ |
| å·¦è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§ | å•è°ƒé€’å‡æ ˆ | ä»å³åˆ°å·¦ |
| å·¦è¾¹ç¬¬ä¸€ä¸ªæ›´å° | å•è°ƒé€’å¢æ ˆ | ä»å³åˆ°å·¦ |


# ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å¤§å°å †æ¥è§£å†³è¿™ç§é—®é¢˜ï¼Ÿï¼Ÿ


è¿™ä¸ªé—®é¢˜é—®å¾—éå¸¸å¥½ğŸ‘ï¼Œå¾ˆå¤šäººåˆšå­¦å•è°ƒæ ˆæ—¶éƒ½ä¼šäº§ç”Ÿè¿™ä¸ªç–‘é—®ï¼š

> â€œæ—¢ç„¶å †ï¼ˆPriorityQueueï¼‰èƒ½å¸®æˆ‘ä»¬å¿«é€Ÿæ‹¿åˆ°æœ€å¤§/æœ€å°å€¼ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨å•è°ƒæ ˆï¼Ÿâ€

â€”â€” å…³é”®åŒºåˆ«åœ¨äºï¼š**å•è°ƒæ ˆç»´æŠ¤çš„æ˜¯â€œç›¸å¯¹ä½ç½®é¡ºåº + å±€éƒ¨å•è°ƒæ€§â€ï¼Œè€Œå †åªç»´æŠ¤â€œæ•´ä½“å¤§å°å…³ç³»â€**ã€‚
æˆ‘ä»¬æ¥ä»”ç»†æ‹†å¼€è¯´ ğŸ‘‡

---

## ğŸ§© ä¸€ã€å †çš„æ ¸å¿ƒç‰¹æ€§

å †ï¼ˆæ— è®ºæœ€å¤§å †è¿˜æ˜¯æœ€å°å †ï¼‰èƒ½åœ¨ **O(1)** æ—¶é—´æ‰¾åˆ°æœ€å¤§/æœ€å°å€¼ï¼Œ
åœ¨ **O(log n)** æ—¶é—´æ’å…¥æˆ–åˆ é™¤ã€‚

ä½†æ˜¯ï¼š

* å †ä¸­å…ƒç´ æ˜¯ **æ— åºçš„é›†åˆç»“æ„**ï¼›
* ä½ åªèƒ½çŸ¥é“ã€Œå…¨å±€æœ€å° / æœ€å¤§ã€æ˜¯è°ï¼›
* ä½  **ä¸çŸ¥é“å®ƒåœ¨æ•°ç»„ä¸­çš„ä½ç½®**ï¼›
* ä½ ä¹Ÿ **æ— æ³•æ ¹æ®é¡ºåºå¿«é€Ÿç§»é™¤â€œè¿‡æœŸçš„å…ƒç´ â€**ã€‚

---

## ğŸ§  äºŒã€å•è°ƒæ ˆçš„æ ¸å¿ƒç‰¹æ€§

å•è°ƒæ ˆæ˜¯ä¸€ç§ **æŒ‰åŸæ•°ç»„é¡ºåºåŠ¨æ€ç»´æŠ¤â€œæœ‰åºå±€éƒ¨ç»“æ„â€çš„å·¥å…·**ã€‚

å®ƒçš„æœ¬è´¨æ˜¯ï¼š

> åœ¨éå†æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œå®æ—¶è®°å½•ã€Œå½“å‰å…ƒç´ ä¸å‰é¢å…ƒç´ ä¹‹é—´çš„é¡ºåºå…³ç³»ã€ã€‚

**å®ƒä¿ç•™äº†ç´¢å¼•é¡ºåºï¼**
ä¹Ÿå°±æ˜¯è¯´ï¼Œå•è°ƒæ ˆä¸ä»…çŸ¥é“è°æ›´å¤§/æ›´å°ï¼Œè¿˜çŸ¥é“å®ƒä»¬çš„ç›¸å¯¹ä½ç½®ï¼ˆåœ¨è°çš„å·¦è¾¹æˆ–å³è¾¹ï¼‰ã€‚

---

## ğŸ§® ä¸‰ã€ä¸¾ä¸ªå¯¹æ¯”ä¾‹å­

æˆ‘ä»¬æ‹¿ç»å…¸é—®é¢˜ã€Œå³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€æ¥æ¯”è¾ƒã€‚

### ä¾‹å­

```
nums = [2, 1, 4, 3]
```

æˆ‘ä»¬è¦å¾—åˆ°ï¼š

```
2 -> 4
1 -> 4
4 -> æ²¡æœ‰
3 -> æ²¡æœ‰
```

---

### ğŸ§± ç”¨å †è¯•è¯•çœ‹

å‡è®¾ä½ éå†åˆ° `2`ï¼Œä½ æŠŠå®ƒæ”¾è¿›æœ€å¤§å †ï¼›
éå†åˆ° `1`ï¼Œæ”¾è¿›å»ï¼›
éå†åˆ° `4`ï¼Œå †é¡¶ç°åœ¨æ˜¯ 4 â€”â€” æ˜¯çš„ï¼Œå®ƒæ˜¯æœ€å¤§å€¼ï¼Œä½†ï¼š

âŒ ä½ å¹¶ä¸çŸ¥é“ `4` åœ¨ `2` çš„å³è¾¹è¿˜æ˜¯å·¦è¾¹ï¼›
âŒ ä¹Ÿä¸çŸ¥é“ `4` æ˜¯ä¸æ˜¯ç´§æŒ¨ç€ `2` çš„é‚£ä¸ªã€Œç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€ï¼›
âŒ æ›´åˆ«æç»´æŠ¤å¤šä¸ªä¸åŒç´¢å¼•ä¹‹é—´çš„å…³ç³»äº†ã€‚

å †åªèƒ½å‘Šè¯‰ä½ ï¼š

> â€œç°åœ¨æˆ‘æ‰‹é‡Œæœ€å¤§çš„æ•°æ˜¯ 4ã€‚â€

ä½†é¢˜ç›®è¦çš„æ˜¯ï¼š

> â€œåœ¨æˆ‘åé¢ã€è·ç¦»æˆ‘æœ€è¿‘ã€æ¯”æˆ‘å¤§çš„é‚£ä¸ªæ•°æ˜¯è°ã€‚â€

å †æ²¡æœ‰é¡ºåºæ¦‚å¿µï¼Œå®ƒæ— æ³•å›ç­”â€œè°åœ¨å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§â€çš„é—®é¢˜ã€‚

---

### ğŸ§Š ç”¨å•è°ƒæ ˆæ¥åš

å•è°ƒé€’å‡æ ˆçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

| æ­¥éª¤  | å…ƒç´  | æ ˆå†…å®¹ï¼ˆå­˜ç´¢å¼•ï¼‰ | å‡ºæ ˆ/æ›´æ–°æƒ…å†µ     |
| --- | -- | -------- | ----------- |
| i=0 | 2  | [0]      |             |
| i=1 | 1  | [0,1]    |             |
| i=2 | 4  | [ ]      | å‡ºæ ˆ1â†’4ï¼Œå‡ºæ ˆ0â†’4 |
| i=3 | 3  | [2,3]    |             |

å®ƒè‡ªåŠ¨å®Œæˆäº†ï¼š

* æ¯”å½“å‰å°çš„éƒ½è¢«â€œè§£å†³â€ï¼›
* å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§æ˜¯è°ï¼›
* ä¸éœ€è¦æ’åºã€ä¸éœ€è¦ log n æ’å…¥ã€‚

ğŸ‘‰ æ¯ä¸ªå…ƒç´ æœ€å¤šè¿›å‡ºæ ˆä¸€æ¬¡ï¼ŒO(n)ã€‚

---

## âš–ï¸ å››ã€æ€»ç»“åŒºåˆ«

| å¯¹æ¯”é¡¹            | **å•è°ƒæ ˆ**          | **å †**                     |
| -------------- | ---------------- | ------------------------- |
| æ•°æ®ç»“æ„ç‰¹æ€§         | ä¿ç•™é¡ºåºï¼Œå±€éƒ¨å•è°ƒ        | æ— åºï¼Œå…¨å±€å †åº                   |
| ä¸»è¦ç”¨é€”           | æ‰¾â€œå·¦å³ç¬¬ä¸€ä¸ªæ›´å¤§/æ›´å°â€    | æ‰¾å…¨å±€æœ€å€¼ï¼ˆæœ€å¤§ã€æœ€å°ï¼‰              |
| èƒ½å¦çŸ¥é“â€œç›¸å¯¹ä½ç½®â€     | âœ… å¯ä»¥             | âŒ ä¸è¡Œ                      |
| æ—¶é—´å¤æ‚åº¦          | O(n)             | O(n log n)ï¼ˆæ¯æ¬¡æ’å…¥ O(log n)ï¼‰ |
| æ˜¯å¦æ”¯æŒâ€œè¿‡æœŸå…ƒç´ â€å¿«é€Ÿç§»é™¤ | âœ… ç›´æ¥å‡ºæ ˆ           | âŒ ä¸è¡Œï¼Œéœ€æ‡’æƒ°åˆ é™¤æˆ–é‡å»ºå †            |
| å¸¸è§é¢˜ç›®           | æ¯æ—¥æ¸©åº¦ã€æ¥é›¨æ°´ã€æŸ±çŠ¶å›¾æœ€å¤§çŸ©å½¢ | ä¼˜å…ˆé˜Ÿåˆ—ã€Top Kã€åˆå¹¶æœ‰åºæµ          |

---

## ğŸ§© äº”ã€ç±»æ¯”ç†è§£

ä½ å¯ä»¥è¿™æ ·è®°ï¼š

* **å †**ï¼šåƒä¸€ä¸ªã€Œæ’è¡Œæ¦œã€ï¼Œä½ èƒ½éšæ—¶çŸ¥é“è°æœ€é«˜åˆ†ï¼Œä½†ä¸çŸ¥é“è°åœ¨è°åé¢ã€‚
* **å•è°ƒæ ˆ**ï¼šåƒä¸€ä¸ªã€Œé€ä¸ªæ‰«æçš„è§‚å¯Ÿè€…ã€ï¼ŒçŸ¥é“æ¯ä¸ªå…ƒç´ å·¦è¾¹å’Œå³è¾¹æ¯”å®ƒå¤§/å°çš„ç¬¬ä¸€ä¸ªæ˜¯è°ã€‚

---

## ğŸ¯ ç»“è®º

> å•è°ƒæ ˆè§£å†³çš„æ˜¯ â€œå¸¦æœ‰**ç›¸å¯¹ä½ç½®çº¦æŸ** çš„æ¯”è¾ƒé—®é¢˜â€ï¼›
>
> å †è§£å†³çš„æ˜¯ â€œåªå…³å¿ƒ**å…¨å±€å¤§å°å…³ç³»** çš„é—®é¢˜â€ã€‚

æ¢å¥è¯è¯´ï¼š

* â€œæ‰¾ç¬¬ä¸€ä¸ªæ¯”æˆ‘å¤§çš„â€ â†’ **å•è°ƒæ ˆ**
* â€œæ‰¾æ‰€æœ‰äººé‡Œæœ€å¤§çš„â€ â†’ **å †**



